# [ì„ë² ë””ë“œSW] 10. Ready List

<aside>

# ğŸ’– Ready list

</aside>

- `ready list`ëŠ” **ready ìƒíƒœì— ìˆëŠ” taskë“¤ë§Œ bitmap ìƒíƒœë¡œ ê´€ë¦¬**í•œë‹¤.
    
    <aside>
    
    **Q. ì™œ ready listëŠ” bitmap í˜•íƒœë¡œ êµ¬í˜„ë˜ì–´ ìˆë‚˜ìš”?**
    
    bitmapì„ ì‚¬ìš©í•œë‹¤ë©´ linked listì— ë¹„í•´ ê³µê°„ì€ costê°€ ë†’ì§€ë§Œ ì‹œê°„ costëŠ” ì••ë„ì ìœ¼ë¡œ ë‚®ìŠµë‹ˆë‹¤. ready listëŠ” **O(n) time ì•ˆì—** **priorityë¥¼ íŒë³„í•˜ê¸° ìœ„í•´** bitmap í˜•íƒœë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    
    </aside>
    

## Data structure

### âš¡ OSRdyGrp

![image.png](image%2016.png)

- 8ê°œì˜ taskë“¤ì´ ëª¨ì—¬ í•˜ë‚˜ì˜ ê·¸ë£¹ì„ ë§Œë“ ë‹¤.
- ê·¸ groupì„ ê°€ë¦¬í‚¤ëŠ”  pointer.
- ë§Œì•½ ì–´ë–¤ group ì•ˆì— í•˜ë‚˜ë¼ë„ **ready ì¤‘ì¸ task**ê°€ ìˆë‹¤ë©´, ê·¸ taskê°€ ì†í•´ìˆëŠ” groupì˜ bitê°€ 1ì´ ëœë‹¤.

### âš¡ OSRdyTbl[]

![image.png](image%2017.png)

- 8ê°œì˜ groupì´ ìˆê³ , ê° group ë‚´ì—ëŠ” 8ê°œì”© taskë“¤ì´ ìˆë‹¤.
- ê·¸ taskë“¤ì„ ë‹´ê³  ìˆëŠ” array.

### âš¡ OSMapTbl[]

![image.png](image%2018.png)

- ìœ„ ê·¸ë¦¼ì²˜ëŸ¼ **ë¯¸ë¦¬ maskí•˜ê¸° ìœ„í•œ bitë“¤ì´ ì¤€ë¹„ë˜ì–´ìˆëŠ” table.**
    - ì´ë¥¼ ì´ìš©í•´ì„œ ê·¸ ë•Œ ê·¸ ë•Œ bitshiftí•˜ì§€ ì•Šì•„ë„ ë˜ë„ë¡ ë§Œë“ ë‹¤.

### âš¡ OSUnMapTbl[]

## Priority position

![image.png](image%2019.png)

- `Y`: groupì˜ index.
    - **Priority / 8**
- `X`: ready listì—ì„œì˜ xì¢Œí‘œ.
    - **Priority % 8**

### ì˜ˆì‹œ 1. OSRdyTblë¡œ OSRdyGrp ì±„ìš°ê¸°

![image.png](image%2020.png)

### ì˜ˆì‹œ 2. 17ë²ˆ taskê°€ ìƒˆë¡œ ready ìƒíƒœê°€ ë˜ì—ˆë‹¤ë©´?

- OSRdyTbleì˜ (1, 2)ë¥¼ 1ë¡œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
    - `osrRdyTbl[2] |= 00000010`
    - ì´ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í‘œí˜„í•  ìˆ˜ë„ ìˆë‹¤.
        - `OSMapTbl[1]`

<aside>
ğŸ’¡

**Skill: x/8ì€ x<<3ê³¼ ê°™ë‹¤.**

ê·¸ë˜ì„œ `prio/8` ëŒ€ì‹  `prio>>3`ìœ¼ë¡œ ì¨ë„ ë†€ë¼ì§€ ë§ìâ€¦

</aside>

### ì˜ˆì‹œ 3. 17ë²ˆ taskê°€ wait ìƒíƒœë¡œ ë³€í–ˆë‹¤ë©´?

```cpp
if ((OSRdyTbl[prio >> 3] &= ~OSMapTbl[prio & 0x07]) == 0)
OSRdyGrp &= ~OSMapTbl[prio >> 3];
```

1. **`OSRdyTbl[]`ì— 0ì´ í•œ ê°œë„ ì—†ë‹¤ë©´**, `OSRdyGrp`ì˜ bitë„ 0ìœ¼ë¡œ ë°”ê¿”ì¤˜ì•¼ í•œë‹¤.
2. `OSRdyTbl[]`ì˜ ì›í•˜ëŠ” (x, y)ë¥¼ 0ìœ¼ë¡œ ë°”ê¾¼ë‹¤.
    1. row: OSRdyTbl[prio >> 3] 
    2. column: ~OSMapTbl[prio & 0x07]

## Find highest proirity task

1. í•œ  group ë‚´ì—ì„œ ìš°ì„ ìˆœìœ„ê°€ ê°€ì¥ ë†’ì€ taskë¥¼ í•˜ë‚˜ì”© ì°¾ìœ¼ë ¤ë©´ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼.
2. ì´ ë•Œ **ready groupê³¼ ready tableì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ê°’ì˜ ë²”ìœ„**ë¥¼ ì´ìš©í•¨.
    1. [00000000, 11111111] â†’ [0, 255]
    2. ì´ë¥¼ ì•„ë˜ì˜ tableë¡œ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë†“ìŒâ€¦!!
        
        ```cpp
        INT8U const OSUnMapTbl[] = {
        0, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        6, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        7, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        6, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0,
        4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0
        };
        ```
        
    3. ì˜ˆë¥¼ ë“¤ì–´, `OSRdyGrp`ì´ 01101000ì´ë¼ë©´,
        1. `OSUnMapTbl[104] == 3`
            1. 3ë²ˆì§¸ groupì´ ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë†’êµ¬ë‚˜â€¦!
        2. `OSUnMapTbl[3] == 2` 
            1. 3ë²ˆì§¸ groupì˜ 2ë²ˆì§¸ taskê°€ ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë†’êµ¬ë‚˜â€¦!
        3. ìš°ì„ ìˆœìœ„ê°€ ê°€ì¥ ë†’ì€ taskëŠ” 26ë²ˆ task
            1. 3ë²ˆì§¸ groupì˜ 2ë²ˆì§¸ task
            2. == 3*8+2
            3. == (3<<3) + 2
            4. == 26
    4. ì´ë¥¼ ì½”ë“œë¡œ ë‚˜íƒ€ë‚´ë©´ ë‹¤ìŒê³¼ ê°™ìŒ
        
        ```cpp
        y = OSUnMapTbl[OSRdyGrp];
        x = OSUnMapTbl[OSRdyTbl[y]];
        prio = (y << 3) + x; 
        ```